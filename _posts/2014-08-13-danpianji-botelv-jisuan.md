---
layout: post
title: 单片机波特率计算
category: github
description: 单片机波特率计算
img: jekyll/jekyll.jpg
keywords: 单片机波特率计算
---

单片机串口通讯的时候都要设置波特率，2400， 9600， 19200等。
那波特率究竟如何得到呢，怎么计算就很重要了。
波特率的计算跟晶振有关系。
mode0 fosc/12
mode1 K*fosc/(16*12*(256-TH1))
mode2 K*fosc/64
mode3 K*fosc/(32*12*(256-TH1))
K表示PCON中是否波特率加倍，fosc为晶振频率
51单片机波特率最高可到57600。

我们要得到9600 的波特率，晶振为11.0592M 和12M，定时器1 为模式2，SMOD 设为1，分别看看那所要求的TH1 为何值
11.0592M            9600＝(2÷32)×((11.0592M/12)/(256-TH1))                TH1＝250   
 12M                9600＝(2÷32)×((12M/12)/(256-TH1))                     TH1≈249.49
 
当晶振为12M时有小数，因此有偏差， 故我们一般选择11.0592M的晶振。
用11.0592晶振的原因是51单片机的定时器导致的。用51单片机的定时器做波特率发生器时，
如果用11.0592Mhz的晶振，根据公式算下来需要定时器设置的值都是整数；
如果用12Mhz晶振，则波特率都是有偏差的，比如9600，用定时器取0XFD，实际波特率10000，一般波特率偏差在4％左右都是可以的，
所以也还能用晶振12M 波特率9600 ，倍数时误差率6.99%，不倍数时误差率8.51%，数据肯定会出错。 
这也就是串口通信时大家喜欢用11.0592MHz晶振的原因，在波特率倍速时，最高可达到57600，误差率0.00%。 
用12MHz，最高也就4800，而且有0.16%误差率，但在允许范围，所以没多大影响。
